# Backend Practice

## 1. Skill Stacks

- Typescript
- Nest.JS
- TypeORM (MySQL, I write raw SQL query to practice sql query)
- Jest
- Docker ( Soon )
- Github Actions ( Soon )

## 2. Entities

    User,
        Create,
        Read,
        Update,
        Delete,
    Post,

μ°Έκ³ 
https://github.com/jojoldu/monorepo-nestjs-typeorm/blob/master/apps/api/src/user/dto/UserSignupReq.ts
https://jojoldu.tistory.com/610

μ—λ¬ ν•Έλ“¤λ§
https://velog.io/@intellik/NestJS-ν¨κ³Όμ μΈ-μμ™Έ-ν•Έλ“¤λ§
https://cheese10yun.github.io/spring-guide-exception/

JWT ν† ν° λ‹¤λ£¨κΈ°
https://www.reddit.com/r/reactjs/comments/14r0s8q/when_accesstoken_is_expired_for_jwt_authenication/
https://inpa.tistory.com/entry/WEB-π“-Access-Token-Refresh-Token-μ›λ¦¬-feat-JWT#access_/_refresh_token_μ¬λ°κΈ‰_μ›λ¦¬

## μ„¤κ³„ν• JWT ν† ν° ν•Έλ“¤λ§ ν•™μµκ³Ό λ°©λ²•

### API μ”μ²­μ‹

1. APIμ”μ²­μ‹ Guardμ—μ„ Access Tokenμ„ κ²€μ¦ν•λ‹¤.
2. Access Tokenμ΄ μ ν¨ν•λ‹¤λ©΄, APIλ¥Ό μ‹¤ν–‰ν•λ‹¤.
3. Access Tokenμ΄ λ§λ£λμ—μ„ κ²½μ°, ν† ν° λ§λ£ μ—λ¬λ¥Ό λμ§„λ‹¤.
   2-1. Filter λλ” Intercepterμ—μ„ ν† ν° λ§λ£ μ—λ¬λ¥Ό μ²λ¦¬ν•λ‹¤. (global Filterλ΅ κµ¬ν„)
   2-2. Refresh ν† ν°μ„ ν™•μΈν•μ—¬ Refresh ν† ν°μ΄ μ ν¨ν•λ‹¤λ©΄ Access Tokenμ„ μ¬λ°κΈ‰ν•λ‹¤.
   2-2. Refresh ν† ν°μ΄ λ§λ£λμ—μ„ κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.
4. Access Tokenμ΄ μ ν¨ν•μ§€ μ•μ„ κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.

#### 1. Access Tokenμ΄ μ ν¨ν•μ§€ μ•μ„ κ²½μ° 401 μ—λ¬λ¥Ό λμ§€λ” κ²½μ°

1. APIμ”μ²­μ‹ Guardμ—μ„ Access Tokenμ„ κ²€μ¦ν•λ‹¤.
2. Access Tokenμ΄ μ ν¨ ν•  κ²½μ°, APIλ¥Ό μ‹¤ν–‰ν•λ‹¤.
3. Access Tokenμ΄ λ§λ£ λ° μ ν¨ν•μ§€ μ•μ„κ²½μ° μ—λ¬λ¥Ό λμ§„λ‹¤.  
   3.1 λ§λ£ λ κ²½μ°: 401μ—λ¬μ™€ λ§λ£ μ—λ¬λ©”μ„Έμ§€  
   3.2 μ ν¨ν•μ§€ μ•μ€ κ²½μ°: 401μ—λ¬μ™€ μ ν¨ν•μ§€ μ•μ€ μ—λ¬λ©”μ„Έμ§€
4. μ—λ¬λ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” ν† ν° Refresh κ³Όμ •μ— λ”°λΌμ„ Access Tokenμ„ μ¬λ°κΈ‰ μ”μ²­μ„ λ³΄λ‚Έλ‹¤.
5. ν† ν°μ„ μ„±κ³µμ μΌλ΅ μ¬λ°κΈ‰ λ°›μ•λ‹¤λ©΄ APIλ¥Ό μ¬μ”μ²­ν•λ‹¤.

#### 2. Access Tokenμ΄ μ ν¨ν•μ§€ μ•μ„ κ²½μ° μλ™μΌλ΅ μ¬λ°κΈ‰ν•λ” κ²½μ°

1. APIμ”μ²­μ‹ Guardμ—μ„ Access Tokenμ„ κ²€μ¦ν•λ‹¤.
2. Access Tokenμ΄ μ ν¨ ν•  κ²½μ°, APIλ¥Ό μ‹¤ν–‰ν•λ‹¤.
3. Access Tokenμ΄ λ§λ£ λ° μ ν¨ν•μ§€ μ•μ„κ²½μ° μ—λ¬λ¥Ό λμ§„λ‹¤.  
   3.1 λ§λ£ λ κ²½μ°  
   a. Filter λλ” Intercepterμ—μ„ ν† ν° λ§λ£ μ—λ¬λ¥Ό μ²λ¦¬ν•λ‹¤. (global Filterλ΅ κµ¬ν„)  
    b. Refresh ν† ν°μ„ ν™•μΈν•μ—¬ Refresh ν† ν°μ΄ μ ν¨ν•λ‹¤λ©΄ Access Tokenμ„ μ¬λ°κΈ‰ν•λ‹¤.  
    c. Refresh ν† ν°μ΄ λ§λ£λμ—μ„ κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.

   3.2 μ ν¨ν•μ§€ μ•μ€ κ²½μ°: μ λ‹Ήν• μ—λ¬λ¥Ό λμ Έ ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.

4. μ—λ¬λ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” λ΅κ·Έμ•„μ›ƒν•λ‹¤.

#### 3. Access Tokenμ λ§λ£μ‹κ°„μ„ κ³„μ‚°ν•μ—¬ λ§λ£κ°€ λκΈ°μ „μ— μ¬λ°κΈ‰ν•λ” κ²½μ°

1. APIμ”μ²­μ‹ Guardμ—μ„ Access Tokenμ„ κ²€μ¦ν•λ‹¤.
2. Access Tokenμ΄ μ ν¨ ν•  κ²½μ°, APIλ¥Ό μ‹¤ν–‰ν•λ‹¤.
3. λ§λ£μ‹κ°„μ΄ κ³§ λ„λν•λ‹¤λ©΄ Access Tokenμ„ μ¬λ°κΈ‰ν•λ‹¤.
4. Access Tokenμ΄ λ§λ£ λ° μ ν¨ν•μ§€ μ•μ„κ²½μ° μ—λ¬λ¥Ό λμ§„λ‹¤.  
   3.1 λ§λ£ λ κ²½μ°  
   a. Filter λλ” Intercepterμ—μ„ ν† ν° λ§λ£ μ—λ¬λ¥Ό μ²λ¦¬ν•λ‹¤. (global Filterλ΅ κµ¬ν„)  
    b. Refresh ν† ν°μ„ ν™•μΈν•μ—¬ Refresh ν† ν°μ΄ μ ν¨ν•λ‹¤λ©΄ Access Tokenμ„ μ¬λ°κΈ‰ν•λ‹¤.  
    c. Refresh ν† ν°μ΄ λ§λ£λμ—μ„ κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.

   3.2 μ ν¨ν•μ§€ μ•μ€ κ²½μ°: μ λ‹Ήν• μ—λ¬λ¥Ό λμ Έ ν΄λΌμ΄μ–ΈνΈλ¥Ό λ΅κ·Έμ•„μ›ƒ μ‹ν‚¨λ‹¤.

5. μ—λ¬λ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” λ΅κ·Έμ•„μ›ƒν•λ‹¤.

#### κ²°μ •

1,2,3λ²μ λ°©λ²•μ„ κ³ λ ¤ν•΄λ³Έ κ²°κ³Ό 1λ²μ λ°©λ²•λ€λ΅ κµ¬ν„μ„ ν•λ”κ² κ°€μ¥ μ μ ν•λ‹¤κ³  μƒκ°ν•λ‹¤.

1,2,3λ² λ°©λ²•μ κ³µν†µμ μ€ ν΄λΌμ΄μ–ΈνΈκ°€ ν† ν° λ§λ£ μ—λ¬λ¥Ό λ°›μ•μ„ λ•, ν΄λΌμ΄μ–ΈνΈκ°€ ν† ν° μ¬λ°κΈ‰ μ”μ²­μ„ λ³΄λ‚΄μ•Όν•λ‹¤λ” κ²ƒμ΄λ‹¤.

2,3λ²μ΄ μΆ‹μ•„λ³΄μ€λ μ΄μ λ” ν΄λΌμ΄μ–ΈνΈκ°€ ν† ν°μ”μ²­μ„ ν•μ§€ μ•κ³  λ°±μ—”λ“μ—μ„ ν† ν°λ§λ£μ΄μλ¥Ό μλ™μΌλ΅ μ²λ¦¬ν•μ—¬ APIλ¥Ό μ‹¤ν–‰ν•κ³  ν΄λΌμ΄μ–ΈνΈλ”
ν† ν°μ΄ λ§λ£λμ—λ”λΌλ„ λ°±μ—”λ“μ—μ„ μλ™μΌλ΅ μ΄λ¥Ό μ²λ¦¬ν•μ—¬ μ¬λ°κΈ‰μ”μ²­μ„ λ³΄λ‚΄μ§€ μ•λ„λ΅ ν•λ”κ²ƒμΈλ° μ΄λ” μ•„λμ™€ κ°™μ€ μ΄μκ°€ μμμ„ ν™•μΈν–λ‹¤.

**2λ² λ°©λ²•μ μ΄μ**

- ν† ν°μ΄ λ§λ£λμ–΄ μ—λ¬λ¥Ό λμ§€λ©΄ Filterμ—μ„ μ—λ¬λ¥Ό μ²λ¦¬ν•΄μ•Όν•λ‹¤. μ΄ κ³Όμ •μ—μ„ ν† ν°μ„ μ¬λ°κΈ‰μ„ ν•λ‹¤.
- μ¬λ°κΈ‰ ν›„ μ•μ„ μ‹¤ν¨ν• μ”μ²­μ— λ€ν•΄μ„ Nest.jsμ λΌμ΄ν”„μ‚¬μ΄ν΄μ„ λ’¤λ΅ κ±°μ¬λ¬ APIλ¥Ό μ‹¤ν–‰ν•λ”κ²ƒμ€ νλ“¤μ–΄ λ³΄μΈλ‹¤.  
   κ·Έλ¦¬κ³  λ³΄μ•μ μΈ λ©΄μ—μ„λ„ μΆ‹μ§€ μ•λ‹¤.
- κ·Έλ ‡λ‹¤λ©΄ μƒλ΅μ΄ ν† ν°μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ ν›„ ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό μΈμ‹ν•μ—¬ λ‹¤μ‹ APIμ”μ²­μ„ λ³΄λ‚΄μ•Όν•λ‹¤.

**3λ² λ°©λ²•μ μ΄μ**

- ν† ν°μ΄ λ§λ£λμ–΄ μ—λ¬λ¥Ό λμ§€λ©΄ Filterμ—μ„ μ—λ¬λ¥Ό μ²λ¦¬ν•΄μ•Όν•λ‹¤. μ΄ κ³Όμ •μ—μ„ ν† ν°μ„ μ¬λ°κΈ‰μ„ ν•λ‹¤.
- Guard λλ” Interceptorμ—μ„ ν•­μƒ ν† ν°μ λ§λ£μ‹κ°„μ„ κ³„μ‚°ν•΄μ•Όν•λ” μ΄μκ°€ μλ‹¤.
- λ§λ£κΈ°κ°„μ΄ λ„λν•κΈ°μ „ μƒ ν† ν°μ„ λ°κΈ‰ν•λ”λΌλ„ 2λ²μ μ΄μλ¥Ό λ§λ‚λ‹¤. ( ν΄λΌμ΄μ–ΈνΈκ°€ μƒλ΅μ΄ ν† ν°μ„ μΈμ‹ν•κ³  APIμ”μ²­μ„ λ³΄λ‚΄μ•Όν•¨ )
- Access Tokenμ΄ λ§λ£ λ ν›„ API μ”μ²­μ„ λ³΄λ‚΄λ” μΌ€μ΄μ¤κ°€ λ‹Ήμ—°ν μμ„ μ μλ‹¤.
- κ·Έλ ‡λ‹¤λ©΄ λ‹¤μ‹ 1,2λ² λ°©λ²•μ¤‘ ν•λ‚λ΅ κ²°μ •μ„ ν•΄μ•Όν•λ‹¤. ( λ‘κ°™μ€ λ¬Έμ μ λ°μƒ )

**κ²°λ΅ **

- 2,3λ² λ°©λ²•μ€ μ½”λ“μ λ³µμ΅λ„λ¥Ό μ¦κ°€μ‹ν‚¨λ‹¤.
- μΏ ν‚¤λ¥Ό ν†µν•΄μ„ Access Tokenμ„ ν΄λΌμ΄μ–ΈνΈμ— λ³΄λ‚΄μ£Όκ³  μκΈ°λ•λ¬Έμ— ν΄λΌμ΄μ–ΈνΈκ°€ μƒλ΅μ΄ ν† ν°μ„ μ„¤μ •ν•κΈ° μ„ν•΄μ„λ” μ–΄μ§ν”Ό ν΄λΌμ΄μ–ΈνΈλ΅ Access Token κ΄€λ ¨ν•΄μ„ μ‘λ‹µμ΄ κ°€μ•Όν•λ‹¤. κ·Έλ ‡λ‹¤λ©΄ ν΄λΌμ΄μ–ΈνΈ <-> λ°±μ—”λ“ μ”μ²­μ νμλ΅λ§ λ”°μ Έλ΄¤μ„λ•λ” ν† ν° μ¬λ°κΈ‰ μ”μ²­μ„ μ¤„μ—¬ μ”μ²­μ„ μ¤„μ—¬λ³΄κ³ μ ν–λ 2,3λ²λ°©λ²•μ€ μ μλ―Έν• μ΄μ μ΄ μ—†μ–΄λ³΄μΈλ‹¤.

### ν† ν° Refresh κ³Όμ •

1. ν† ν° λ§λ£ μ—λ¬λ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” Access Tokenκ³Ό Refresh Tokenμ„ κ°€μ§€κ³  ν† ν° μ¬λ°κΈ‰ μ”μ²­μ„ ν•λ‹¤.
2. /auth/refreshλ΅ API μ”μ²­μ„ ν•λ‹¤.
3. ν† ν° κ²€μ¦ λ΅μ§ μ‹¤ν–‰
   3-1. access token λ§λ£, refresh token μ ν¨ -> ACCESS TOKEN μ¬λ°κΈ‰
   3-2. access token λ§λ£, refresh token λ§λ£ -> λ΅κ·Έμ•„μ›ƒ
   3-3. access token μ ν¨, refresh token λ§λ£ -> λ΅κ·Έμ•„μ›ƒ

# TODO
